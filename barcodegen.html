<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Multi-Format Barcode Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { --paper-width: 210mm; --paper-height: 297mm; }
        body { font-family: Arial, sans-serif; background: #eef1f4; padding: 20px; margin: 0; }
        
        .no-print { 
            max-width: 900px; margin: auto; background: white; padding: 25px; 
            border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 30px; 
        }

        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        textarea { grid-column: span 3; height: 100px; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
        
        .field-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; font-weight: bold; color: #555; }
        select, input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; }

        .stats { grid-column: span 3; background: #f8f9fa; padding: 10px; border-radius: 6px; font-size: 14px; color: #333; border-left: 4px solid #007bff; }
        
        .btn-group { grid-column: span 3; display: flex; gap: 10px; margin-top: 10px; }
        button { flex: 1; padding: 14px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; font-size: 16px; transition: 0.2s; }
        .btn-gen { background: #007bff; color: white; }
        .btn-pdf { background: #28a745; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        /* Paper Simulation Area */
        #print-area { 
            width: var(--paper-width); 
            min-height: var(--paper-height);
            margin: auto;
            background: white;
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            align-content: start;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }

        .barcode-card { 
            border: 0.1mm solid #eee; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8mm 4mm;
            page-break-inside: avoid;
        }

        svg { width: 100% !important; height: auto !important; }

        @media print {
            .no-print { display: none; }
            body { padding: 0; background: white; }
            #print-area { margin: 0; border: none; box-shadow: none; width: var(--paper-width); }
        }
    </style>
</head>
<body>

<div class="no-print">
    <h2 style="margin-top:0">Pro Barcode Suite</h2>
    <div class="controls">
        <textarea id="barcode-input" placeholder="Enter codes (one per line)...&#10;7K2P9N4X&#10;B5M1R8W3"></textarea>
        
        <div class="field-group">
            <label>Paper Size</label>
            <select id="paper-size" onchange="updatePaperSize()">
                <option value="a4">A4 (Standard)</option>
                <option value="letter">US Letter</option>
                <option value="a5">A5 (Small)</option>
            </select>
        </div>

        <div class="field-group">
            <label>Quantity Per Code</label>
            <input type="number" id="qty-input" value="1" min="1">
        </div>

        <div class="field-group">
            <label>Label Height (mm)</label>
            <input type="number" id="height-input" value="40" min="20">
        </div>

        <div class="stats" id="counter">Total Labels: 0 | Pages: 0</div>

        <div class="btn-group">
            <button class="btn-gen" onclick="generateBarcodes()">Generate Labels</button>
            <button class="btn-pdf" onclick="exportToPDF()">Save PDF</button>
        </div>
    </div>
</div>

<div id="print-area"></div>

<script>
    const sizes = {
        a4: { w: '210mm', h: '297mm' },
        letter: { w: '215.9mm', h: '279.4mm' },
        a5: { w: '148mm', h: '210mm' }
    };

    function updatePaperSize() {
        const selected = document.getElementById('paper-size').value;
        const root = document.querySelector(':root');
        root.style.setProperty('--paper-width', sizes[selected].w);
        root.style.setProperty('--paper-height', sizes[selected].h);
    }

    function generateBarcodes() {
        const input = document.getElementById('barcode-input').value;
        const qty = parseInt(document.getElementById('qty-input').value) || 1;
        const labelHeight = document.getElementById('height-input').value;
        const printArea = document.getElementById('print-area');
        
        const codes = input.split('\n').filter(code => code.trim() !== "");
        printArea.innerHTML = ""; 

        let totalCount = 0;

        codes.forEach((code, index) => {
            for(let i = 0; i < qty; i++) {
                const card = document.createElement('div');
                card.className = 'barcode-card';
                card.style.height = labelHeight + "mm";
                
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                const uniqueId = `b-${index}-${i}`;
                svg.setAttribute("id", uniqueId);
                
                card.appendChild(svg);
                printArea.appendChild(card);

                JsBarcode(`#${uniqueId}`, code, {
                    format: "CODE128",
                    width: 3,
                    height: 60,
                    displayValue: true,
                    font: "Arial",
                    fontSize: 16,
                    margin: 5
                });
                totalCount++;
            }
        });

        document.getElementById('counter').innerText = `Total Labels: ${totalCount} | Estimated Pages: ${Math.ceil(totalCount/24)}`;
    }

    async function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const element = document.getElementById('print-area');
        const paperKey = document.getElementById('paper-size').value;
        
        if (!element.hasChildNodes()) return alert("No barcodes to export!");

        const canvas = await html2canvas(element, { scale: 2 });
        const imgData = canvas.toDataURL('image/png');
        
        // Match PDF size to the selected format
        const pdf = new jsPDF('p', 'mm', paperKey);
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = (canvas.height * pageWidth) / canvas.width;

        pdf.addImage(imgData, 'PNG', 0, 0, pageWidth, pageHeight);
        pdf.save(`barcodes_${paperKey}.pdf`);
    }
</script>

</body>
</html>